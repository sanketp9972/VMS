{"ast":null,"code":"import axios from 'axios';\nimport { createUrl, log } from '../utils/utils';\nexport async function registerUser(firstName, lastName, address, phone, email, password, userRoles) {\n  const url = createUrl('/users/register');\n  const body = {\n    firstName,\n    lastName,\n    address,\n    phone,\n    email,\n    password,\n    userRoles\n  };\n\n  try {\n    // Check if the user already exists by email\n    try {\n      const getUserResponse = await axios.get(url);\n\n      if (getUserResponse.data && getUserResponse.data.email === email) {\n        console.log(getUserResponse.data);\n        return {\n          email: ''\n        }; // Return an empty object to indicate existing email\n      }\n\n      if (getUserResponse.data && getUserResponse.data.userRoles === 'USER') {\n        return {\n          userRoles: 'USER'\n        };\n      } else if (getUserResponse.data && getUserResponse.data.userRoles === 'ADMIN') {\n        return {\n          userRoles: 'ADMIN'\n        };\n      } else if (getUserResponse.data && getUserResponse.data.userRoles === 'SALESPERSON') {\n        return {\n          userRoles: 'SALESPERSON'\n        };\n      }\n    } catch (getUserEx) {\n      log('Error fetching user data by email:', getUserEx);\n    } // Proceed with registration if the email is not found in the database\n\n\n    const response = await axios.post(url, body);\n    log(response.data);\n    return response.data;\n  } catch (ex) {\n    log('Error registering user:', ex);\n    return null;\n  }\n}\nexport async function loginUser(email, password) {\n  const url = createUrl('/auth/signin');\n  const body = {\n    email,\n    password\n  }; // wait till axios is making the api call and getting response from server\n\n  try {\n    const response = await axios.post(url, body);\n    log(response.data);\n    const token = response.data.jwt;\n    const userRoles = response.data.userRoles;\n    const userId = response.data.userId;\n    const isLoggedIn = response.data.isLoggedIn;\n    sessionStorage.setItem(\"token\", token);\n    sessionStorage.setItem(\"userRoles\", userRoles);\n    sessionStorage.setItem(\"userId\", userId);\n    sessionStorage.setItem(\"isLoggedIn\", isLoggedIn);\n    return response.data;\n  } catch (ex) {\n    log(ex);\n    return null;\n  }\n}","map":{"version":3,"names":["axios","createUrl","log","registerUser","firstName","lastName","address","phone","email","password","userRoles","url","body","getUserResponse","get","data","console","getUserEx","response","post","ex","loginUser","token","jwt","userId","isLoggedIn","sessionStorage","setItem"],"sources":["/home/vaibhav/Desktop/VMS/vms/src/services/user.js"],"sourcesContent":["import axios from 'axios';\nimport { createUrl, log } from '../utils/utils';\n\nexport async function registerUser(\n  firstName,\n  lastName,\n  address,\n  phone,\n  email,\n  password,\n  userRoles\n) {\n  const url = createUrl('/users/register');\n  const body = {\n    firstName,\n    lastName,\n    address,\n    phone,\n    email,\n    password,\n    userRoles\n  };\n\n  try {\n    // Check if the user already exists by email\n    try {\n      const getUserResponse = await axios.get(url);\n      if (getUserResponse.data && getUserResponse.data.email === email) {\n        console.log(getUserResponse.data);\n        return { email: '' }; // Return an empty object to indicate existing email\n      }\n      if(getUserResponse.data && getUserResponse.data.userRoles === 'USER'){\n        return {userRoles : 'USER'}\n      }\n      else if (getUserResponse.data && getUserResponse.data.userRoles === 'ADMIN'){\n        return {userRoles : 'ADMIN'}\n      }\n      else if (getUserResponse.data && getUserResponse.data.userRoles === 'SALESPERSON'){\n        return {userRoles : 'SALESPERSON'}\n      }\n    } catch (getUserEx) {\n      log('Error fetching user data by email:', getUserEx);\n    }\n\n    // Proceed with registration if the email is not found in the database\n    const response = await axios.post(url, body);\n    log(response.data);\n    return response.data;\n  } catch (ex) {\n    log('Error registering user:', ex);\n    return null;\n  }\n}\n\nexport async function loginUser(email, password) {\n  const url = createUrl('/auth/signin')\n  const body = {\n    email,\n    password,\n  }\n\n  // wait till axios is making the api call and getting response from server\n  try {\n    const response = await axios.post(url, body)\n    log(response.data)\n    const token = response.data.jwt;\n    const userRoles = response.data.userRoles;\n    const userId = response.data.userId;\n    const isLoggedIn = response.data.isLoggedIn;\n\n    sessionStorage.setItem(\"token\" , token);\n    sessionStorage.setItem(\"userRoles\", userRoles);\n    sessionStorage.setItem(\"userId\", userId);\n    sessionStorage.setItem(\"isLoggedIn\", isLoggedIn);\n    return response.data\n  } catch (ex) {\n    log(ex)\n    return null\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}